<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>VoxTalk | A1 Professional Asphalt</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0; font-family: system-ui, -apple-system, sans-serif;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      min-height: 100vh;
      /* Deep Asphalt Gradient */
      background: radial-gradient(circle at 50% 50%, #374151 0%, #111827 50%, #000000 100%);
      color: white; overflow: hidden;
    }
    .app { display: flex; flex-direction: column; align-items: center; text-align: center; width: 100%; }

    .logo-box {
      margin-bottom: 50px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .ai-status {
      font-size: 28px; /* Balanced size so it doesn't overpower the button */
      font-weight: 900;
      line-height: 1.3;
      letter-spacing: 2px;
      color: #facc15; /* Traffic Yellow */
      text-shadow: 0 0 20px rgba(250, 204, 21, 0.4);
      text-transform: uppercase;
      max-width: 90%;
    }

    #pttBtn { 
      width: 210px; height: 210px; /* Slightly scaled to match the text */
      border-radius: 50%; 
      border: 8px solid #ffffff; /* Sharp White Halo */
      cursor: pointer;
      background: radial-gradient(circle at 30% 30%, #facc15, #ca8a04);
      box-shadow: 0 0 50px rgba(250, 204, 21, 0.4); 
      position: relative; outline: none; transition: transform 0.1s ease;
    }

    #pttBtn:active { transform: scale(0.95); }

    /* LISTENING: Static Glow */
    #pttBtn.listening { 
      box-shadow: 0 0 80px rgba(250, 204, 21, 0.8); 
      border-color: #fef08a; 
    }

    /* SPEAKING: Swirl effect when AI talks */
    #pttBtn.speaking::before {
      content: ""; position: absolute; inset: -12px; border-radius: 50%;
      background: conic-gradient(from 0deg, #fef08a, #facc15, #854d0e, #fef08a);
      animation: swirl 0.8s linear infinite;
      -webkit-mask: radial-gradient(circle, rgba(0,0,0,0) 65%, rgba(0,0,0,1) 66%);
              mask: radial-gradient(circle, rgba(0,0,0,0) 65%, rgba(0,0,0,1) 66%);
    }
    @keyframes swirl { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    
    #answer { display: none !important; }
  </style>
</head>
<body>
  <div class="app">
    <div class="logo-box">
      <div class="ai-status">TALK TO OUR<br>AI TEAM MEMBER</div>
    </div>

    <button id="pttBtn" aria-pressed="false"></button>
    <div id="answer"></div>
    <audio id="remote" autoplay playsinline></audio>
  </div>
  <script>
    const pttBtn = document.getElementById('pttBtn');
    const rtAudio = document.getElementById('remote');
    function setListening(on) { pttBtn.classList.toggle('listening', on); }
    function setSpeaking(on) { pttBtn.classList.toggle('speaking', on); }
    async function initRealtime() {
      try {
        const s = await fetch("/session", { method:"POST" });
        const { client_secret, model, voice } = await s.json();
        const pc = new RTCPeerConnection();
        const mic = await navigator.mediaDevices.getUserMedia({ audio:true });
        const micTrack = mic.getTracks()[0];
        micTrack.enabled = false;
        pc.addTrack(micTrack, mic);
        pc.ontrack = (ev)=> { rtAudio.srcObject = ev.streams[0]; rtAudio.play().catch(()=>{}); };
        const offer = await pc.createOffer({ offerToReceiveAudio:true });
        await pc.setLocalDescription(offer);
        const r = await fetch(`https://api.openai.com/v1/realtime?model=${encodeURIComponent(model)}&voice=${voice}`, {
          method:"POST",
          headers: { "Authorization":`Bearer ${client_secret.value}`, "Content-Type":"application/sdp" },
          body: offer.sdp
        });
        const answer = { type:"answer", sdp: await r.text() };
        await pc.setRemoteDescription(answer);
        let talking = false;
        pttBtn.onclick = () => {
          talking = !talking;
          micTrack.enabled = talking;
          setListening(talking);
          if (!talking) { setListening(false); setSpeaking(false); }
        };
        rtAudio.addEventListener("playing", ()=> setSpeaking(true));
        rtAudio.addEventListener("ended", ()=> setSpeaking(false));
      } catch(err) { console.error("Realtime failed", err); }
    }
    initRealtime();
  </script>
</body>
</html>
